(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{123:function(e,t,a){e.exports=a(212)},132:function(e,t,a){},210:function(e,t,a){},212:function(e,t,a){"use strict";a.r(t);a(124),a(126);var n=a(0),r=a.n(n),o=a(25),c=a.n(o),i=a(227),s=(a(132),a(14)),l=a(15),u=a(17),m=a(16),p=a(18),d=a(44),h=a(221),b=a(225),f=a(29),g=a(119),E=a(226),y=a(8),v=a.n(y),k={apiHost:"https://buffalo-journal.herokuapp.com",stripeKey:"pk_live_doxQ9etmZ8nozRk89VmvoOrZ"};v.a.defaults.headers.common.Accept="application/json";var j={isAuthenticated:!1,isSubscribed:function(){return null!=j.user.subscription_id},isSetUp:function(){return null!=j.user.subscription_id&&null!=j.user.phone_number},authenticate:function(e,t){v.a.defaults.headers.common.Authorization="Bearer "+e,v.a.defaults.headers.common["X-Dumb-Authorization"]="Bearer "+e,window.localStorage.setItem("token",e),v.a.get("".concat(k.apiHost,"/auth/google")).then(function(e){j.isAuthenticated=!0,j.user=e.data,t&&t()})},autoLogin:function(e){var t=window.localStorage.getItem("token");t?j.authenticate(t,e):e&&e()},signout:function(e){console.log("bye now!"),j.isAuthenticated=!1,j.user=null,window.localStorage.removeItem("token"),e&&e()}},O=j,S=function(e){var t=e.component,a=Object(g.a)(e,["component"]);return r.a.createElement(b.a,Object.assign({},a,{render:function(e){return!0===O.isAuthenticated?r.a.createElement(t,e):r.a.createElement(E.a,{to:{pathname:"/login",state:{from:e.location.pathname}}})}}))},C=a(24),x=a(222),w=a(223),I=a(224),M=a(218),D=a(68),L=function(){var e=Object(n.useState)(""),t=Object(C.a)(e,2),a=t[0],o=t[1];return a?r.a.createElement(E.a,{to:a}):!O.isAuthenticated&&r.a.createElement(D.GoogleLogin,{clientId:"300709606324-sec60nd2b4hba9b1gkqdcpdlhv2p89kk.apps.googleusercontent.com",buttonText:"Login",onSuccess:function(e){O.authenticate(e.tokenId,function(){O.isAuthenticated&&O.isSetUp()?o("/journal/".concat(O.user.id)):O.isAuthenticated&&!O.isSetUp()&&o("/settings/".concat(O.user.id))})},onFailure:function(e){console.log("login failed",e),v.a.defaults.headers.common.Authorization=null}})};var R=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(u.a)(this,Object(m.a)(t).call(this,e))).logout=function(){O.signout(function(){a.setState({redirect:!0})})},a.renderRedirect=function(){if(a.state.redirect)return r.a.createElement(E.a,{to:"/"})},a.state={redirect:!1},a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,this.renderRedirect(),r.a.createElement(x.a.Item,{onSelect:this.logout},"Logout"))}}]),t}(n.Component);var U=function(e){var t=function(e){if(!e)return null;var t=e.split("/"),a=t.indexOf("public");return-1===a?null:t[a+1]}(e.location),a=Object(n.useState)(null),o=Object(C.a)(a,2),c=o[0],i=o[1];return Object(n.useEffect)(function(){t&&!c&&v.a.get("".concat(k.apiHost,"/public/").concat(t,"/")).then(function(e){i(e.data)})},[t]),r.a.createElement(w.a,{sticky:"top"},r.a.createElement(r.a.Fragment,null,!t&&O.isAuthenticated?r.a.createElement(I.a,null,r.a.createElement(x.a,{title:"Monthly",id:"summaries-dropdown"},r.a.createElement(I.a.Link,{as:M.a,eventKey:"overviews",to:"/summaries/".concat(O.user.id,"/default")},"Overviews"),r.a.createElement(I.a.Link,{as:M.a,eventKey:"haikus",to:"/summaries/".concat(O.user.id,"/haiku")},"Haikus"),r.a.createElement(I.a.Link,{as:M.a,eventKey:"poetry",to:"/summaries/".concat(O.user.id,"/poetry")},"Poems")),r.a.createElement(I.a.Link,{as:M.a,eventKey:"journal",to:"/journal/".concat(O.user.id)},"Journal"),r.a.createElement(I.a.Link,{as:M.a,eventKey:"settings",to:"/settings/".concat(O.user.id)},"Settings"),r.a.createElement(x.a,{title:O.user.first_name,id:"user-dropdown"},r.a.createElement(R,null))):t&&c?r.a.createElement(I.a,null,r.a.createElement(x.a,{title:"".concat(c.first_name,"'s Months"),id:"public-summaries-dropdown"},r.a.createElement(I.a.Link,{as:M.a,eventKey:"public-overviews",to:"/public/".concat(t,"/summaries/default")},"Public Overviews"),r.a.createElement(I.a.Link,{as:M.a,eventKey:"public-haikus",to:"/public/".concat(t,"/summaries/haiku")},"Public Haikus"),r.a.createElement(I.a.Link,{as:M.a,eventKey:"public-poetry",to:"/public/".concat(t,"/summaries/poetry")},"Public Poems")),r.a.createElement(I.a.Link,{as:M.a,eventKey:"public-journal",to:"/public/".concat(t,"/journal")},"Public Journal"),r.a.createElement(I.a.Link,{as:M.a,eventKey:"public-signin",to:"/"},O.isAuthenticated?"Mine":"Sign Up")):null))},P=a(40),_=a(22),A=a.n(_),B=a(37),H=a(39),T=a.n(H),K=a(43),N=a.n(K),z=a(219),Y=a(220),F=a(57),J=a.n(F),Z=a(30),$=a(31),q=a(32);function G(e){var t={position:"relative",left:"4px",top:"4px",color:"rgba(".concat(e.color.r,",").concat(e.color.g,",").concat(e.color.b,",0.1)"),":hover":{color:"rgba(".concat(e.color.r,",").concat(e.color.g,",").concat(e.color.b,",0.4)")}},a={cursor:"pointer",":hover":{color:"rgba(".concat(e.color.r,",").concat(e.color.g,",").concat(e.color.b,",1)")}},n=function(){var t=Object(B.a)(A.a.mark(function t(){return A.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,v.a.delete(e.entryUrl);case 3:e.handleDelete&&e.handleDelete(e.entryId),t.next=9;break;case 6:t.prev=6,t.t0=t.catch(0),console.log(t.t0);case 9:case"end":return t.stop()}},t,null,[[0,6]])}));return function(){return t.apply(this,arguments)}}();return r.a.createElement("div",{style:t},r.a.createElement("div",null,r.a.createElement("div",{key:"trash".concat(e.entryId),className:"trash",style:a},r.a.createElement("a",{onClick:n},r.a.createElement($.a,{icon:q.c})))))}function Q(e){var t=Object(n.useState)(!1),a=Object(C.a)(t,2),o=a[0],c=a[1],i="linear-gradient(0deg, rgba(".concat(e.endColor.r,",").concat(e.endColor.g,",").concat(e.endColor.b,",1) 0%, rgba(").concat(e.startColor.r,",").concat(e.startColor.g,",").concat(e.startColor.b,",1) 100%)"),s=e.periodStart?"15px":"0px",l=e.periodEnd?"15px":"0px",u={background:i,marginBottom:"2px",padding:"15px"},m=Object(P.a)({},u,{color:"white",marginRight:"2px",borderTopLeftRadius:s,borderBottomLeftRadius:l}),p=Object(P.a)({},u,{background:i,color:"black",borderTopRightRadius:s,borderBottomRightRadius:l,fontSize:"20px"}),d={backgroundColor:"white",padding:"10px",borderTopRightRadius:s,borderBottomRightRadius:l,opacity:"70%"};return o?null:r.a.createElement(z.a,null,r.a.createElement(Y.a,{md:2,mdOffset:2,sm:2,smOffset:2,style:m},r.a.createElement(z.a,null,r.a.createElement(Y.a,null,r.a.createElement(T.a,{format:"YYYY/MM/DD"},e.data.date))),r.a.createElement(z.a,null,r.a.createElement(Y.a,null,r.a.createElement(T.a,{style:{opacity:"50%"},format:"dddd"},e.data.date))),r.a.createElement(z.a,null,r.a.createElement(Y.a,null,r.a.createElement(T.a,{style:{opacity:"50%"},fromNow:!0},e.data.date)))),r.a.createElement(Y.a,{style:p},r.a.createElement("div",{style:d},e.data.entry)),!e.isPublic&&r.a.createElement(G,{entryId:e.data.id,entryUrl:e.data.selfUrl,color:e.startColor,handleDelete:function(){c(!0)}}))}G=Object(d.a)(G);var V=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(u.a)(this,Object(m.a)(t).call(this,e))).loadUser=function(){v.a.get("".concat(k.apiHost,"/public/").concat(a.props.match.params.userId,"/")).then(function(e){a.setState({publicUser:e.data})})},a.loadEntries=function(e){var t=a.state.isDesc?"DESC":"ASC";v.a.get("".concat(a.url,"?page=").concat(e,"&per_page=").concat(20,"&order=").concat(t)).then(function(e){var t=a.state.entries,n=e.data,r=a.state.color,o=function(e){var t=Math.floor(32*Math.random()),a=1-e/128;return Math.random()<a?e+t:e-t},c=0;n.forEach(function(e){e.selfUrl="".concat(k.apiHost,"/users/").concat(a.props.match.params.userId,"/entries/").concat(e.id);var i={r:o(r.r),g:o(r.g),b:o(r.b)};if(e.startColor=r,e.endColor=i,(0===t.length||n[c-1]&&n[c-1].periodEnd)&&(e.periodStart=!0),n.length>c+1){var s=n[c+1];N()(e.date).month()!=N()(s.date).month()&&(e.periodEnd=!0)}c++,t.push(e),r=i});var i=!0;n.length<20&&(i=!1),a.setState({entries:t,hasMore:i,color:r})})},a.isPublic=a.props.location.pathname.includes("public"),a.url=a.isPublic?"".concat(k.apiHost,"/public/").concat(a.props.match.params.userId,"/entries/"):"".concat(k.apiHost,"/users/").concat(a.props.match.params.userId,"/entries/"),a.state={isDesc:"ASC"!==a.props.match.params.order,entries:[],publicUser:null,hasMore:!0,color:{r:0,g:128,b:181}},a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.isPublic&&this.loadUser()}},{key:"render",value:function(){var e=this,t=[];return this.state.entries.forEach(function(a){t.push(r.a.createElement(Q,{isPublic:e.isPublic,startColor:a.startColor,endColor:a.endColor,key:a.id,periodStart:a.periodStart,periodEnd:a.periodEnd,data:a}))}),r.a.createElement("div",{key:this.state.isDesc},r.a.createElement(Z.CoffeeLoading,{style:{position:"relative",left:"50%",marginBottom:"10px"}}),this.isPublic?this.state.publicUser&&this.state.publicUser.first_name&&r.a.createElement("h3",{style:{textAlign:"center",fontFamily:"'Playfair Display', serif",opacity:"70%"}},"Today, ",this.state.publicUser.first_name," ",this.state.publicUser.last_name,"..."):r.a.createElement("h3",{style:{textAlign:"center",fontFamily:"'Playfair Display', serif",opacity:"70%"}},"Today, I..."),r.a.createElement("a",{style:{position:"relative",left:"50%",marginBottom:"10px"},onClick:function(){return e.setState({isDesc:!e.state.isDesc,entries:[],hasMore:!0})}},this.state.isDesc?r.a.createElement($.a,{icon:q.a}):r.a.createElement($.a,{icon:q.b})),r.a.createElement(J.a,{pageStart:0,loadMore:this.loadEntries.bind(this),hasMore:this.state.hasMore,loader:this.state.entries.length>0?r.a.createElement(Z.LoopCircleLoading,{size:"small",style:{position:"relative",left:"50%",marginTop:"20px"}}):null},t))}}]),t}(n.Component),W=a(45),X=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(u.a)(this,Object(m.a)(t).call(this,e))).submit=a.submit.bind(Object(W.a)(Object(W.a)(a))),a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"submit",value:function(){var e=Object(B.a)(A.a.mark(function e(t){var a,n,r=this;return A.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.stripe.createToken({name:this.props.userId});case 2:a=e.sent,n=a.token,v.a.post("".concat(k.apiHost,"/users/").concat(this.props.userId,"/subscription"),{card_token:n.id}).then(function(e){r.props.cb&&r.props.cb()});case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){return r.a.createElement("div",{className:"checkout"},r.a.createElement("p",null,"Subscribe for ",r.a.createElement("strong",null,"$24")," per year with a 14-day free trial, cancel anytime"),r.a.createElement(f.CardElement,null),r.a.createElement("button",{onClick:this.submit},"Subscribe for $24"))}}]),t}(n.Component),ee=Object(f.injectStripe)(X),te=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(u.a)(this,Object(m.a)(t).call(this,e))).handleChange=function(e){a.setState({phoneNumber:e.target.value})},a.handleSubmit=function(e){v.a.put("".concat(k.apiHost,"/users/").concat(a.props.match.params.userId,"/"),{phone_number:a.state.phoneNumber}).then(function(e){alert("successfully updated your phone number, congratulations")}),e.preventDefault()},a.handleSubscribe=function(){a.setState({isSubscribed:!0}),O.user.subscription_id="they subbed dont worry about it"},a.state={phoneNumber:"",isSubscribed:O.isSubscribed()},a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;v.a.get("".concat(k.apiHost,"/users/").concat(this.props.match.params.userId,"/")).then(function(t){var a=t.data.phone_number;e.setState({phoneNumber:a||""})})}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(z.a,null,r.a.createElement(Y.a,null,this.state.isSubscribed?r.a.createElement("form",null,r.a.createElement("label",null,"Phone Number"),r.a.createElement("input",{type:"text",value:this.state.phoneNumber,onChange:this.handleChange,name:"phone_number"}),r.a.createElement("input",{type:"submit",value:"Submit",onClick:this.handleSubmit})):null)),r.a.createElement(z.a,null,r.a.createElement(Y.a,null,this.state.isSubscribed?r.a.createElement("p",null,"Thanks for subscribing--if you're trying to cancel you'll need to email me: ",r.a.createElement("a",{href:"mailto:dailyjournalsubscriptions@gmail.com?Subject=Cancellation"},"dailyjournalsubscriptions@gmail.com")):r.a.createElement(f.Elements,null,r.a.createElement(ee,{userId:this.props.match.params.userId,cb:this.handleSubscribe})))))}}]),t}(n.Component);var ae=function(e){return r.a.createElement("div",null,"Welcome!",r.a.createElement(L,null))};a(209);function ne(e){var t=Object(n.useState)({}),a=Object(C.a)(t,2),o=(a[0],a[1],"linear-gradient(0deg, rgba(".concat(e.endColor.r,",").concat(e.endColor.g,",").concat(e.endColor.b,",1) 0%, rgba(").concat(e.startColor.r,",").concat(e.startColor.g,",").concat(e.startColor.b,",1) 100%)")),c=e.periodStart?"15px":"0px",i=e.periodEnd?"15px":"0px",s={background:o,marginBottom:"2px",padding:"15px"},l=Object(P.a)({},s,{color:"white",marginRight:"2px",borderTopLeftRadius:c,borderBottomLeftRadius:i}),u=Object(P.a)({},s,{background:o,color:"black",borderTopRightRadius:c,borderBottomRightRadius:i,fontSize:"20px"}),m={whiteSpace:"pre-wrap",backgroundColor:"white",padding:"10px",borderTopRightRadius:c,borderBottomRightRadius:i,opacity:"70%"};return r.a.createElement(z.a,null,r.a.createElement(Y.a,{md:2,mdOffset:2,sm:2,smOffset:2,style:l},r.a.createElement(z.a,null,r.a.createElement(Y.a,null,r.a.createElement(T.a,{format:"MMM YYYY"},e.data.start_date)))),r.a.createElement(Y.a,{style:u},e.data.summary?r.a.createElement("div",{style:m},e.data.summary.trim()):r.a.createElement(Z.CoffeeLoading,null)))}var re=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(u.a)(this,Object(m.a)(t).call(this,e))).loadSummaries=function(){var e=Object(B.a)(A.a.mark(function e(t){var n,r,o,c,i,s,l,u;return A.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=1,r=a.state.isDesc?"DESC":"ASC",e.next=4,v.a.get("".concat(a.url,"?page=").concat(t,"&per_page=").concat(n,"&style=").concat(a.props.match.params.style,"&order=").concat(r));case 4:o=e.sent,c=a.state.summaries,i=o.data,s=a.state.color,l=function(e){var t=Math.floor(32*Math.random()),a=1-e/128;return Math.random()<a?e+t:e-t},i.forEach(function(e){if("00000000-0000-0000-0000-000000000000"!==e.id){var t={r:l(s.r),g:l(s.g),b:l(s.b)};e.startColor=s,e.endColor=t,s=t,c.push(e)}}),u=!0,i.length<n&&(u=!1),a.setState({summaries:c,hasMore:u,color:s});case 13:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.loadUser=function(){v.a.get("".concat(k.apiHost,"/public/").concat(a.props.match.params.userId,"/")).then(function(e){a.setState({publicUser:e.data})})},a.isPublic=a.props.location.pathname.includes("public"),a.url=a.isPublic?"".concat(k.apiHost,"/public/").concat(a.props.match.params.userId,"/summaries/").concat(a.props.match.params.style):"".concat(k.apiHost,"/users/").concat(a.props.match.params.userId,"/summaries/"),a.state={summaries:[],isDesc:"ASC"!==a.props.match.params.order,hasMore:!0,publicUser:null,color:{r:128,g:0,b:181}},a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidUpdate",value:function(e){e.match.params.style!==this.props.match.params.style&&this.setState({summaries:[],hasMore:!0})}},{key:"componentDidMount",value:function(){this.isPublic&&this.loadUser()}},{key:"render",value:function(){var e=this,t=[];return this.state.summaries.forEach(function(a){t.push(r.a.createElement(ne,{startColor:a.startColor,endColor:a.endColor,key:e.props.match.params.style+a.start_date+a.id,periodStart:!0,periodEnd:!0,data:a}))}),r.a.createElement("div",{key:this.props.match.params.style+this.state.isDesc},r.a.createElement(Z.CoffeeLoading,{style:{position:"relative",left:"50%",marginBottom:"10px"}}),this.isPublic?this.state.publicUser&&this.state.publicUser.first_name?r.a.createElement("h3",{style:{textAlign:"center",fontFamily:"'Playfair Display', serif",opacity:"70%"}},"This month, ",this.state.publicUser.first_name," ",this.state.publicUser.last_name,"..."):null:r.a.createElement("h3",{style:{textAlign:"center",fontFamily:"'Playfair Display', serif",opacity:"70%"}},"This month, I..."),r.a.createElement("a",{style:{position:"relative",left:"50%",marginBottom:"10px"},onClick:function(){return e.setState({isDesc:!e.state.isDesc,summaries:[],hasMore:!0})}},this.state.isDesc?r.a.createElement($.a,{icon:q.a}):r.a.createElement($.a,{icon:q.b})),r.a.createElement(J.a,{pageStart:0,loadMore:this.loadSummaries.bind(this),hasMore:this.state.hasMore,loader:this.state.summaries.length>0?r.a.createElement(Z.LoopCircleLoading,{size:"small",style:{position:"relative",left:"50%",marginTop:"20px"}}):null},t))}}]),t}(n.Component),oe=(a(210),function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement(h.a,null,r.a.createElement(f.StripeProvider,{apiKey:k.stripeKey},r.a.createElement("div",null,r.a.createElement(U,{location:window.location.href}),r.a.createElement(S,{path:"/journal/:userId",component:V}),r.a.createElement(S,{path:"/summaries/:userId/:style",component:re}),r.a.createElement(S,{path:"/settings/:userId",component:te}),r.a.createElement(b.a,{path:"/public/:userId/journal",component:V}),r.a.createElement(b.a,{path:"/public/:userId/summaries/:style",component:re}),r.a.createElement(b.a,{exact:!0,path:"/",component:ae}))))}}]),t}(n.Component)),ce=Object(d.a)(oe);O.autoLogin(function(){return c.a.render(r.a.createElement(i.a,null,r.a.createElement(ce,null)),document.getElementById("root"))})}},[[123,2,1]]]);
//# sourceMappingURL=main.0c90ea29.chunk.js.map