(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{156:function(e,t,n){},158:function(e,t,n){"use strict";n.r(t);n(76),n(78);var a=n(0),r=n.n(a),o=n(22),c=n.n(o),i=n(173),u=(n(85),n(14)),s=n(15),l=n(17),m=n(16),d=n(18),p=n(167),h=n(172),b=n(26),f=n(71),g=n(171),E=n(12),v=n.n(E),j={apiHost:"https://buffalo-journal.herokuapp.com",stripeKey:"pk_live_doxQ9etmZ8nozRk89VmvoOrZ"};v.a.defaults.headers.common.Accept="application/json";var y={isAuthenticated:!1,isSubscribed:function(){return null!=y.user.subscription_id},isSetUp:function(){return null!=y.user.subscription_id&&null!=y.user.phone_number},authenticate:function(e,t){v.a.defaults.headers.common.Authorization="Bearer "+e,v.a.defaults.headers.common["X-Dumb-Authorization"]="Bearer "+e,window.localStorage.setItem("token",e),v.a.get("".concat(j.apiHost,"/auth/google")).then(function(e){y.isAuthenticated=!0,y.user=e.data,t&&t()})},autoLogin:function(e){var t=window.localStorage.getItem("token");t&&y.authenticate(t,e)},signout:function(e){console.log("bye now!"),y.isAuthenticated=!1,y.user=null,window.localStorage.removeItem("token"),e&&e()}},O=y,k=function(e){var t=e.component,n=Object(f.a)(e,["component"]);return r.a.createElement(g.a,Object.assign({},n,{render:function(e){return!0===O.isAuthenticated?r.a.createElement(t,e):r.a.createElement(h.a,{to:{pathname:"/",state:{from:e.location}}})}}))},S=n(168),C=n(169),w=n(170),R=n(164),x=n(59),I=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(l.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(r)))).state={redirectToPreviousRoute:!1},n.responseGoogle=function(e){O.authenticate(e.tokenId,function(){n.setState({redirectToPreviousRoute:!0})})},n.failGoogle=function(e){console.log("login failed",e),v.a.defaults.headers.common.Authorization=null},n.componentWillMount=function(){O.autoLogin(function(){n.setState({redirectToPreviousRoute:!0})})},n}return Object(d.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return this.state.redirectToPreviousRoute?r.a.createElement(h.a,{to:"/"}):r.a.createElement(x.GoogleLogin,{clientId:"300709606324-sec60nd2b4hba9b1gkqdcpdlhv2p89kk.apps.googleusercontent.com",buttonText:"Login",onSuccess:this.responseGoogle,onFailure:this.failGoogle})}}]),t}(a.Component),A=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(l.a)(this,Object(m.a)(t).call(this,e))).logout=function(){O.signout(function(){n.setState({redirect:!0})})},n.renderRedirect=function(){if(n.state.redirect)return r.a.createElement(h.a,{to:"/"})},n.state={redirect:!1},n}return Object(d.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,this.renderRedirect(),r.a.createElement(S.a.Item,{onSelect:this.logout},"Logout"))}}]),t}(a.Component);var M=function(){return r.a.createElement(C.a,{sticky:"top"},O.isAuthenticated?r.a.createElement(w.a,{defaultActiveKey:"journal"},r.a.createElement(w.a.Link,{as:R.a,eventKey:"journal",to:"/journal/".concat(O.user.id)},"Journal"),r.a.createElement(w.a.Link,{as:R.a,eventKey:"settings",to:"/settings/".concat(O.user.id)},"Settings"),r.a.createElement(S.a,{title:O.user.first_name,id:"user-dropdown"},r.a.createElement(A,null))):r.a.createElement(I,null))},_=n(46),T=n.n(_),L=n(165),N=n(166),B=n(65),H=n.n(B),K=n(47);function P(e){var t="linear-gradient(0deg, rgba(".concat(e.endColor.r,",").concat(e.endColor.g,",").concat(e.endColor.b,",1) 0%, rgba(").concat(e.startColor.r,",").concat(e.startColor.g,",").concat(e.startColor.b,",1) 100%)"),n=e.cornerRadius?e.cornerRadius:"0px";return r.a.createElement(L.a,null,r.a.createElement(N.a,{md:2,mdOffset:2,sm:2,smOffset:2,style:{background:t,color:"white",marginBottom:"2px",marginRight:"2px",padding:"15px",borderTopLeftRadius:n}},r.a.createElement(L.a,null,r.a.createElement(N.a,null,r.a.createElement(T.a,{format:"YYYY/MM/DD"},e.data.date))),r.a.createElement(L.a,null,r.a.createElement(N.a,null,r.a.createElement(T.a,{style:{opacity:"50%"},fromNow:!0},e.data.date)))),r.a.createElement(N.a,{style:{background:t,color:"black",marginBottom:"2px",padding:"15px",borderTopRightRadius:n,fontSize:"20px"}},r.a.createElement("div",{style:{backgroundColor:"white",padding:"10px",borderTopRightRadius:n,opacity:"70%"}},e.data.entry)))}var z=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(l.a)(this,Object(m.a)(t).call(this,e))).loadEntries=function(e){v.a.get("".concat(j.apiHost,"/users/").concat(n.props.match.params.userId,"/entries/?page=").concat(e,"&per_page=").concat(20)).then(function(e){var t=n.state.entries,a=e.data,r=n.state.color,o=function(e){var t=Math.floor(32*Math.random()),n=1-e/128;return Math.random()<n?e+t:e-t};a.forEach(function(e){var n={r:o(r.r),g:o(r.g),b:o(r.b)};e.startColor=r,e.endColor=n,0===t.length&&(e.cornerRadius="15px"),t.push(e),r=n});var c=!0;a.length<20&&(c=!1),n.setState({entries:t,hasMore:c,color:r})})},n.state={entries:[],hasMore:!0,color:{r:0,g:128,b:181}},n}return Object(d.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=[];return this.state.entries.forEach(function(t){e.push(r.a.createElement(P,{startColor:t.startColor,endColor:t.endColor,key:t.id,cornerRadius:t.cornerRadius,data:t}))}),r.a.createElement("div",null,r.a.createElement(K.CoffeeLoading,{style:{position:"relative",left:"50%",marginBottom:"10px"}}),r.a.createElement(H.a,{pageStart:0,loadMore:this.loadEntries.bind(this),hasMore:this.state.hasMore,loader:this.state.entries.length>0?r.a.createElement(K.CoffeeLoading,{style:{position:"relative",left:"50%",marginTop:"20px"}}):null},e))}}]),t}(a.Component),D=n(51),G=n.n(D),Y=n(68),J=n(30),U=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(l.a)(this,Object(m.a)(t).call(this,e))).submit=n.submit.bind(Object(J.a)(Object(J.a)(n))),n}return Object(d.a)(t,e),Object(s.a)(t,[{key:"submit",value:function(){var e=Object(Y.a)(G.a.mark(function e(t){var n,a,r=this;return G.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.stripe.createToken({name:this.props.userId});case 2:n=e.sent,a=n.token,v.a.post("".concat(j.apiHost,"/users/").concat(this.props.userId,"/subscription"),{card_token:a.id}).then(function(e){console.log("cool"),r.props.cb&&r.props.cb()});case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){return r.a.createElement("div",{className:"checkout"},r.a.createElement("p",null,"Subscribe for ",r.a.createElement("strong",null,"$1.33")," per month with a 7-day free trial, cancel anytime"),r.a.createElement(b.CardElement,null),r.a.createElement("button",{onClick:this.submit},"Subscribe for $1.33"))}}]),t}(a.Component),Z=Object(b.injectStripe)(U),$=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(l.a)(this,Object(m.a)(t).call(this,e))).handleChange=function(e){n.setState({phoneNumber:e.target.value})},n.handleSubmit=function(e){v.a.put("".concat(j.apiHost,"/users/").concat(n.props.match.params.userId,"/"),{phone_number:n.state.phoneNumber}).then(function(e){alert("successfully updated your phone number, congratulations")}),e.preventDefault()},n.handleSubscribe=function(){n.setState({isSubscribed:!0}),O.user.subscription_id="they subbed dont worry about it"},n.state={phoneNumber:"",isSubscribed:O.isSubscribed()},n}return Object(d.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){var e=this;v.a.get("".concat(j.apiHost,"/users/").concat(this.props.match.params.userId,"/")).then(function(t){var n=t.data.phone_number;e.setState({phoneNumber:n||""})})}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(L.a,null,r.a.createElement(N.a,null,this.state.isSubscribed?r.a.createElement("form",null,r.a.createElement("label",null,"Phone Number"),r.a.createElement("input",{type:"text",value:this.state.phoneNumber,onChange:this.handleChange,name:"phone_number"}),r.a.createElement("input",{type:"submit",value:"Submit",onClick:this.handleSubmit})):null)),r.a.createElement(L.a,null,r.a.createElement(N.a,null,this.state.isSubscribed?r.a.createElement("p",null,"Thanks for subscribing--if you're trying to cancel you'll need to email me: ",r.a.createElement("a",{href:"mailto:dailyjournalsubscriptions@gmail.com?Subject=Cancellation"},"dailyjournalsubscriptions@gmail.com")):r.a.createElement(b.Elements,null,r.a.createElement(Z,{userId:this.props.match.params.userId,cb:this.handleSubscribe})))))}}]),t}(a.Component),q=(n(156),function(e){function t(){return Object(u.a)(this,t),Object(l.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return r.a.createElement(p.a,null,r.a.createElement(b.StripeProvider,{apiKey:j.stripeKey},r.a.createElement("div",null,r.a.createElement(M,null),r.a.createElement(k,{path:"/journal/:userId",component:z}),r.a.createElement(k,{path:"/settings/:userId",component:$}),O.isAuthenticated&&O.isSetUp()?r.a.createElement(h.a,{to:"/journal/".concat(O.user.id)}):O.isAuthenticated&&!O.isSetUp()?r.a.createElement(h.a,{to:"/settings/".concat(O.user.id)}):null)))}}]),t}(a.Component));c.a.render(r.a.createElement(i.a,null,r.a.createElement(q,null)),document.getElementById("root"))},75:function(e,t,n){e.exports=n(158)},85:function(e,t,n){}},[[75,2,1]]]);
//# sourceMappingURL=main.63f3521a.chunk.js.map