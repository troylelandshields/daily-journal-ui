(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{124:function(e,t,a){e.exports=a(213)},133:function(e,t,a){},211:function(e,t,a){},213:function(e,t,a){"use strict";a.r(t);a(125),a(127);var n=a(0),r=a.n(n),o=a(25),c=a.n(o),i=a(224),s=(a(133),a(12)),l=a(13),u=a(16),d=a(14),m=a(17),p=a(42),h=a(222),b=a(223),f=a(229),g=a(28),E=a(120),v=a(228),y=a(9),j=a.n(y),S={apiHost:"https://buffalo-journal.herokuapp.com",stripeKey:"pk_live_doxQ9etmZ8nozRk89VmvoOrZ"};j.a.defaults.headers.common.Accept="application/json";var O={isAuthenticated:!1,isSubscribed:function(){return null!=O.user.subscription_id},isSetUp:function(){return null!=O.user.subscription_id&&null!=O.user.phone_number},authenticate:function(e,t){j.a.defaults.headers.common.Authorization="Bearer "+e,j.a.defaults.headers.common["X-Dumb-Authorization"]="Bearer "+e,window.localStorage.setItem("token",e),j.a.get("".concat(S.apiHost,"/auth/google")).then(function(e){O.isAuthenticated=!0,O.user=e.data,t&&t()})},autoLogin:function(e){var t=window.localStorage.getItem("token");t&&O.authenticate(t,e)},signout:function(e){console.log("bye now!"),O.isAuthenticated=!1,O.user=null,window.localStorage.removeItem("token"),e&&e()}},C=O,k=function(e){var t=e.component,a=Object(E.a)(e,["component"]);return r.a.createElement(v.a,Object.assign({},a,{render:function(e){return!0===C.isAuthenticated?r.a.createElement(t,e):r.a.createElement(f.a,{to:{pathname:"/",state:{from:e.location}}})}}))},w=a(225),x=a(226),M=a(227),R=a(219),D=a(82),I=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={dst:"",query:""},a.responseGoogle=function(e){C.authenticate(e.tokenId,function(){C.isAuthenticated&&C.isSetUp()?a.setState({dst:"/journal/".concat(C.user.id)}):C.isAuthenticated&&!C.isSetUp()&&a.setState({dst:"/settings/".concat(C.user.id)})})},a.failGoogle=function(e){console.log("login failed",e),j.a.defaults.headers.common.Authorization=null},a.componentWillMount=function(){C.autoLogin(function(){C.isAuthenticated&&C.isSetUp()?a.setState({dst:"/journal/".concat(C.user.id),query:window.location.query}):C.isAuthenticated&&!C.isSetUp()&&a.setState({dst:"/settings/".concat(C.user.id),query:window.location.query})})},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.state,t=e.dst,a=e.query;return t&&window.location.pathname!==t?r.a.createElement(f.a,{to:{pathname:t,query:a}}):r.a.createElement(D.GoogleLogin,{clientId:"300709606324-sec60nd2b4hba9b1gkqdcpdlhv2p89kk.apps.googleusercontent.com",buttonText:"Login",onSuccess:this.responseGoogle,onFailure:this.failGoogle})}}]),t}(n.Component),A=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).logout=function(){C.signout(function(){a.setState({redirect:!0})})},a.renderRedirect=function(){if(a.state.redirect)return r.a.createElement(f.a,{to:"/"})},a.state={redirect:!1},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,this.renderRedirect(),r.a.createElement(w.a.Item,{onSelect:this.logout},"Logout"))}}]),t}(n.Component);var L=function(){return r.a.createElement(x.a,{sticky:"top"},C.isAuthenticated?r.a.createElement(M.a,{defaultActiveKey:"journal"},r.a.createElement(M.a.Link,{as:R.a,eventKey:"summaries",to:"/summaries/".concat(C.user.id)},"Summaries"),r.a.createElement(M.a.Link,{as:R.a,eventKey:"journal",to:"/journal/".concat(C.user.id)},"Journal"),r.a.createElement(M.a.Link,{as:R.a,eventKey:"settings",to:"/settings/".concat(C.user.id)},"Settings"),r.a.createElement(w.a,{title:C.user.first_name,id:"user-dropdown"},r.a.createElement(A,null))):r.a.createElement(I,null))},B=a(39),_=a(61),T=a(23),U=a.n(T),q=a(36),H=a(38),N=a.n(H),Y=a(41),K=a.n(Y),z=a(220),G=a(221),J=a(56),P=a.n(J),$=a(29),Z=a(30),F=a(31);function Q(e){var t={position:"relative",left:"4px",top:"4px",color:"rgba(".concat(e.color.r,",").concat(e.color.g,",").concat(e.color.b,",0.1)"),":hover":{color:"rgba(".concat(e.color.r,",").concat(e.color.g,",").concat(e.color.b,",0.4)")}},a={cursor:"pointer",":hover":{color:"rgba(".concat(e.color.r,",").concat(e.color.g,",").concat(e.color.b,",1)")}},n=function(){var t=Object(q.a)(U.a.mark(function t(){return U.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,j.a.delete(e.entryUrl);case 3:e.handleDelete&&e.handleDelete(e.entryId),t.next=9;break;case 6:t.prev=6,t.t0=t.catch(0),console.log(t.t0);case 9:case"end":return t.stop()}},t,null,[[0,6]])}));return function(){return t.apply(this,arguments)}}();return r.a.createElement("div",{style:t},r.a.createElement("div",null,r.a.createElement("div",{key:"trash".concat(e.entryId),className:"trash",style:a},r.a.createElement("a",{onClick:n},r.a.createElement(Z.a,{icon:F.c})))))}function V(e){var t=Object(n.useState)(!1),a=Object(_.a)(t,2),o=a[0],c=a[1],i="linear-gradient(0deg, rgba(".concat(e.endColor.r,",").concat(e.endColor.g,",").concat(e.endColor.b,",1) 0%, rgba(").concat(e.startColor.r,",").concat(e.startColor.g,",").concat(e.startColor.b,",1) 100%)"),s=e.periodStart?"15px":"0px",l=e.periodEnd?"15px":"0px",u={background:i,marginBottom:"2px",padding:"15px"},d=Object(B.a)({},u,{color:"white",marginRight:"2px",borderTopLeftRadius:s,borderBottomLeftRadius:l}),m=Object(B.a)({},u,{background:i,color:"black",borderTopRightRadius:s,borderBottomRightRadius:l,fontSize:"20px"}),p={backgroundColor:"white",padding:"10px",borderTopRightRadius:s,borderBottomRightRadius:l,opacity:"70%"};return o?null:r.a.createElement(z.a,null,r.a.createElement(G.a,{md:2,mdOffset:2,sm:2,smOffset:2,style:d},r.a.createElement(z.a,null,r.a.createElement(G.a,null,r.a.createElement(N.a,{format:"YYYY/MM/DD"},e.data.date))),r.a.createElement(z.a,null,r.a.createElement(G.a,null,r.a.createElement(N.a,{style:{opacity:"50%"},format:"dddd"},e.data.date))),r.a.createElement(z.a,null,r.a.createElement(G.a,null,r.a.createElement(N.a,{style:{opacity:"50%"},fromNow:!0},e.data.date)))),r.a.createElement(G.a,{style:m},r.a.createElement("div",{style:p},e.data.entry)),r.a.createElement(Q,{entryId:e.data.id,entryUrl:e.data.selfUrl,color:e.startColor,handleDelete:function(){c(!0)}}))}Q=Object(p.a)(Q);var W=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).loadEntries=function(e){var t=a.state.isDesc?"DESC":"ASC";j.a.get("".concat(S.apiHost,"/users/").concat(a.props.match.params.userId,"/entries/?page=").concat(e,"&per_page=").concat(20,"&order=").concat(t)).then(function(e){var t=a.state.entries,n=e.data,r=a.state.color,o=function(e){var t=Math.floor(32*Math.random()),a=1-e/128;return Math.random()<a?e+t:e-t},c=0;n.forEach(function(e){e.selfUrl="".concat(S.apiHost,"/users/").concat(a.props.match.params.userId,"/entries/").concat(e.id);var i={r:o(r.r),g:o(r.g),b:o(r.b)};if(e.startColor=r,e.endColor=i,(0===t.length||n[c-1]&&n[c-1].periodEnd)&&(e.periodStart=!0),n.length>c+1){var s=n[c+1];K()(e.date).month()!=K()(s.date).month()&&(e.periodEnd=!0)}c++,t.push(e),r=i});var i=!0;n.length<20&&(i=!1),a.setState({entries:t,hasMore:i,color:r})})},a.state={isDesc:"ASC"!==a.props.match.params.order,entries:[],hasMore:!0,color:{r:0,g:128,b:181}},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=[];return this.state.entries.forEach(function(e){t.push(r.a.createElement(V,{startColor:e.startColor,endColor:e.endColor,key:e.id,periodStart:e.periodStart,periodEnd:e.periodEnd,data:e}))}),r.a.createElement("div",{key:this.state.isDesc},r.a.createElement($.CoffeeLoading,{style:{position:"relative",left:"50%",marginBottom:"10px"}}),r.a.createElement("a",{style:{position:"relative",left:"50%",marginBottom:"10px"},onClick:function(){return e.setState({isDesc:!e.state.isDesc,entries:[],hasMore:!0})}},this.state.isDesc?r.a.createElement(Z.a,{icon:F.a}):r.a.createElement(Z.a,{icon:F.b})),r.a.createElement(P.a,{pageStart:0,loadMore:this.loadEntries.bind(this),hasMore:this.state.hasMore,loader:this.state.entries.length>0?r.a.createElement($.CoffeeLoading,{style:{position:"relative",left:"50%",marginTop:"20px"}}):null},t))}}]),t}(n.Component),X=a(43),ee=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).submit=a.submit.bind(Object(X.a)(Object(X.a)(a))),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"submit",value:function(){var e=Object(q.a)(U.a.mark(function e(t){var a,n,r=this;return U.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.stripe.createToken({name:this.props.userId});case 2:a=e.sent,n=a.token,j.a.post("".concat(S.apiHost,"/users/").concat(this.props.userId,"/subscription"),{card_token:n.id}).then(function(e){r.props.cb&&r.props.cb()});case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){return r.a.createElement("div",{className:"checkout"},r.a.createElement("p",null,"Subscribe for ",r.a.createElement("strong",null,"$24")," per year with a 14-day free trial, cancel anytime"),r.a.createElement(g.CardElement,null),r.a.createElement("button",{onClick:this.submit},"Subscribe for $24"))}}]),t}(n.Component),te=Object(g.injectStripe)(ee),ae=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).handleChange=function(e){a.setState({phoneNumber:e.target.value})},a.handleSubmit=function(e){j.a.put("".concat(S.apiHost,"/users/").concat(a.props.match.params.userId,"/"),{phone_number:a.state.phoneNumber}).then(function(e){alert("successfully updated your phone number, congratulations")}),e.preventDefault()},a.handleSubscribe=function(){a.setState({isSubscribed:!0}),C.user.subscription_id="they subbed dont worry about it"},a.state={phoneNumber:"",isSubscribed:C.isSubscribed()},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;j.a.get("".concat(S.apiHost,"/users/").concat(this.props.match.params.userId,"/")).then(function(t){var a=t.data.phone_number;e.setState({phoneNumber:a||""})})}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(z.a,null,r.a.createElement(G.a,null,this.state.isSubscribed?r.a.createElement("form",null,r.a.createElement("label",null,"Phone Number"),r.a.createElement("input",{type:"text",value:this.state.phoneNumber,onChange:this.handleChange,name:"phone_number"}),r.a.createElement("input",{type:"submit",value:"Submit",onClick:this.handleSubmit})):null)),r.a.createElement(z.a,null,r.a.createElement(G.a,null,this.state.isSubscribed?r.a.createElement("p",null,"Thanks for subscribing--if you're trying to cancel you'll need to email me: ",r.a.createElement("a",{href:"mailto:dailyjournalsubscriptions@gmail.com?Subject=Cancellation"},"dailyjournalsubscriptions@gmail.com")):r.a.createElement(g.Elements,null,r.a.createElement(te,{userId:this.props.match.params.userId,cb:this.handleSubscribe})))))}}]),t}(n.Component);a(210);function ne(e){var t=Object(n.useState)({}),a=Object(_.a)(t,2),o=(a[0],a[1],"linear-gradient(0deg, rgba(".concat(e.endColor.r,",").concat(e.endColor.g,",").concat(e.endColor.b,",1) 0%, rgba(").concat(e.startColor.r,",").concat(e.startColor.g,",").concat(e.startColor.b,",1) 100%)")),c=e.periodStart?"15px":"0px",i=e.periodEnd?"15px":"0px",s={background:o,marginBottom:"2px",padding:"15px"},l=Object(B.a)({},s,{color:"white",marginRight:"2px",borderTopLeftRadius:c,borderBottomLeftRadius:i}),u=Object(B.a)({},s,{background:o,color:"black",borderTopRightRadius:c,borderBottomRightRadius:i,fontSize:"20px"}),d={whiteSpace:"pre-wrap",backgroundColor:"white",padding:"10px",borderTopRightRadius:c,borderBottomRightRadius:i,opacity:"70%"};return r.a.createElement(z.a,null,r.a.createElement(G.a,{md:2,mdOffset:2,sm:2,smOffset:2,style:l},r.a.createElement(z.a,null,r.a.createElement(G.a,null,r.a.createElement(N.a,{format:"MMM YYYY"},e.data.start_date)))),r.a.createElement(G.a,{style:u},e.data.summary?r.a.createElement("div",{style:d},e.data.summary.trim()):r.a.createElement($.CoffeeLoading,null)))}var re=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).loadSummaries=function(){var e=Object(q.a)(U.a.mark(function e(t){var n,r,o,c,i,s,l,u;return U.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=1,r=a.state.isDesc?"DESC":"ASC",e.next=4,j.a.get("".concat(S.apiHost,"/users/").concat(a.props.match.params.userId,"/summaries/?page=").concat(t,"&per_page=").concat(n,"&style=").concat(a.state.style,"&order=").concat(r));case 4:o=e.sent,c=a.state.summaries,i=o.data,s=a.state.color,l=function(e){var t=Math.floor(32*Math.random()),a=1-e/128;return Math.random()<a?e+t:e-t},i.forEach(function(e){if("00000000-0000-0000-0000-000000000000"!==e.id){var t={r:l(s.r),g:l(s.g),b:l(s.b)};e.startColor=s,e.endColor=t,s=t,c.push(e)}}),u=!0,i.length<n&&(u=!1),a.setState({summaries:c,hasMore:u,color:s});case 13:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.state={summaries:[],isDesc:"ASC"!==a.props.match.params.order,style:"overview",hasMore:!0,color:{r:128,g:0,b:181}},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=[];return this.state.summaries.forEach(function(e){t.push(r.a.createElement(ne,{startColor:e.startColor,endColor:e.endColor,key:e.start_date,periodStart:!0,periodEnd:!0,data:e}))}),r.a.createElement("div",{key:this.state.style+this.state.isDesc},r.a.createElement($.CoffeeLoading,{style:{position:"relative",left:"50%",marginBottom:"10px"}}),r.a.createElement("a",{style:{position:"relative",left:"50%",marginBottom:"10px"},onClick:function(){return e.setState({isDesc:!e.state.isDesc,summaries:[],hasMore:!0})}},this.state.isDesc?r.a.createElement(Z.a,{icon:F.a}):r.a.createElement(Z.a,{icon:F.b})),r.a.createElement("select",{value:this.state.style,onChange:function(t){e.setState({summaries:[],hasMore:!0,style:t.target.value})}},r.a.createElement("option",{value:"default"},"Overview"),r.a.createElement("option",{value:"haiku"},"Haikus"),r.a.createElement("option",{value:"poetry"},"Poetry")),r.a.createElement(P.a,{pageStart:0,loadMore:this.loadSummaries.bind(this),hasMore:this.state.hasMore,loader:this.state.summaries.length>0?r.a.createElement($.CoffeeLoading,{style:{position:"relative",left:"50%",marginTop:"20px"}}):null},t))}}]),t}(n.Component),oe=(a(211),function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement(h.a,null,r.a.createElement(g.StripeProvider,{apiKey:S.stripeKey},r.a.createElement(b.a,null,r.a.createElement("div",null,r.a.createElement(L,null),r.a.createElement(k,{path:"/journal/:userId",component:W}),r.a.createElement(k,{path:"/summaries/:userId",component:re}),r.a.createElement(k,{path:"/settings/:userId",component:ae}),C.isAuthenticated&&C.isSetUp()?r.a.createElement(f.a,{to:{pathname:"/journal/${auth.user.id}",query:"1=1"}}):C.isAuthenticated&&!C.isSetUp()?r.a.createElement(f.a,{to:"/settings/".concat(C.user.id)}):null))))}}]),t}(n.Component)),ce=Object(p.a)(oe);c.a.render(r.a.createElement(i.a,null,r.a.createElement(ce,null)),document.getElementById("root"))}},[[124,2,1]]]);
//# sourceMappingURL=main.b8f43846.chunk.js.map